package controllers

import (
    "encoding/json"
    "fmt"
    "net/http"
    "strings"
    "DHTWeather/repositories"
    "DHTWeather/models"
)

func SayhelloName(w http.ResponseWriter, r *http.Request) {
    // TODO: Setup a dictionary with http request types and function pointers
    switch r.Method {
        case http.MethodGet:
            getResponse(w, r)
        case http.MethodPost:
            uc.post(w, r)
        default:
            w.WriteHeader(http.StatusNotImplemented)
        }

}

func getResponse(w http.ResponseWriter, r *http.Request) {
    r.ParseForm() // parse arguments, you have to call this by yourself
    fmt.Println(r.Form) // print form information in server side
    fmt.Println("path", r.URL.Path)
    fmt.Println("scheme", r.URL.Scheme)
    fmt.Println(r.Form["url_long"])
    for k, v := range r.Form {
        fmt.Println("key:", k)
        fmt.Println("val:", strings.Join(v, ""))
    }
    fmt.Fprintf(w, "<h1>Hello, World!</h1>") // send data to client side
}

func parseRequest(r *http.Request) (models.Reading, error) {
    dec := json.NewDecoder(r.Body)
    var u models.User
    err := dec.Decode(&u)
    if err != nil {
        return models.User{}, err
    }
    return u, nil
}

func ReadingsHandler(w http.ResponseWriter, r *http.Request) {
    rep := repositories.NewDhtReadingRepository()
    rep.Close()
    
    fmt.Fprintf(w, "Readings")
}
